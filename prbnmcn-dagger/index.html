<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (prbnmcn-dagger.index)</title><link rel="stylesheet" href="../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ prbnmcn-dagger</nav><header class="odoc-preamble"><h1 id="dagger"><a href="#dagger" class="anchor"></a>Dagger</h1><p><em>dagger</em> is a embedded domain-specific language for probabilistic programming in OCaml. Models are written in monadic style. Sampling from the posterior is performed using one of the following algorithms:</p><ul><li>Single-site Metropolis-Hastings, a.k.a. <a href="https://web.stanford.edu/~ngoodman/papers/lightweight-mcmc-aistats2011.pdf">Lightweight Metropolis-Hastings</a></li><li>Incremental single-site MH, similar to that implemented in <a href="http://okmij.org/ftp/kakuritu/Hakaru10/">Hakaru10</a></li><li>Sequential Monte Carlo with programmable resampling</li></ul></header><nav class="odoc-toc"><ul><li><a href="#a-basic-example">A basic example</a></li><li><a href="#more-examples">More examples</a></li><li><a href="#companion-libraries">Companion libraries</a></li><li><a href="#api">API</a></li></ul></nav><div class="odoc-content"><h2 id="a-basic-example"><a href="#a-basic-example" class="anchor"></a>A basic example</h2><p>Let us consider the classical &quot;sprinkler&quot; example (drawn from <a href="https://dl.acm.org/doi/pdf/10.1145/3236778">Functional Programming for Modular Bayesian Inference</a>).</p><p>Our lawn can become wet either because it rained or because the sprinkler is activated. We construct a simple model that encodes our belief that the lawn becomes wet knowing that it rained or not and the sprinkler state.</p><pre class="language-ocaml"><code>open Lmh_inference
open Infix

let model : bool t =
  let open Infix in
  let* rain = sample (Stats_dist.bernoulli ~bias:0.2) in
  let* sprinkler = sample (Stats_dist.bernoulli ~bias:0.1) in
  let prob_lawn_wet =
    match (rain, sprinkler) with
    | (true, true) -&gt; 0.99
    | (true, false) -&gt; 0.7
    | (false, true) -&gt; 0.9
    | (false, false) -&gt; 0.01
  in
  let+ () = score prob_lawn_wet in
  rain</code></pre><p>Each execution trace is weighted by the density of the samples taken in that trace <em>and</em> by calls to the <code>score</code> construct. The inference algorithm samples execution traces proportionally to their total weight. Scoring therefore amounts to a form of soft conditioning (and assigning a score of 0 to a trace amounts to rejecting that trace). Let us sample from the posterior implicitly defined by our <code>model</code>.</p><pre class="language-ocaml"><code>let rng_state = RNG.make [| 0x1337; 0x533D |]

let nsamples = 100_000

let samples =
  Lmh_inference.stream_samples model rng_state
  |&gt; Seq.take nsamples

let freq =
  (samples
  |&gt; Seq.map (fun x -&gt; if x then 1 else 0)
  |&gt; List.of_seq |&gt; List.fold_left ( + ) 0 |&gt; float_of_int)
  /. float_of_int nsamples</code></pre><p>The result is that the probability that it rains knowing that the lawn is wet is approximately equal to 0.64.</p><h2 id="more-examples"><a href="#more-examples" class="anchor"></a>More examples</h2><ul><li><a href="smc_inference_example.html">Polynomial regression using SMC</a></li><li>More advanced examples can be found in the <code>examples</code> subdirectory of the source distribution.</li></ul><h2 id="companion-libraries"><a href="#companion-libraries" class="anchor"></a>Companion libraries</h2><p>In the interest of modularity, sampleable distributions (such as <code>bernoulli</code>) are defined in auxilliary libraries. Currently, we have:</p><ul><li><code>prbnmcn-dagger-gsl</code>, which relies on the OCaml bindings to the GNU <code>gsl</code> library. Note that <code>prbnmcn-dagger-gsl</code> is licensed under the GNU GPL.</li><li><code>prbnmcn-dagger-stats</code>, which relies on <code>prbnmcn-stats</code> (MIT license).</li></ul><h2 id="api"><a href="#api" class="anchor"></a>API</h2><ul class="modules"><li><a href="Dagger/Intf/index.html"><code>Dagger.Intf</code></a> <span class="synopsis">Module type definitions</span></li><li><a href="Dagger/Lmh_inference/index.html"><code>Dagger.Lmh_inference</code></a> <span class="synopsis">Lightweight Metropolis-Hastings</span></li><li><a href="Dagger/Lmh_incremental_inference/index.html"><code>Dagger.Lmh_incremental_inference</code></a> <span class="synopsis">Incremental lightweight Metropolis-Hastings</span></li><li><a href="Dagger/Smc_inference/index.html"><code>Dagger.Smc_inference</code></a> <span class="synopsis">Sequential Monte Carlo</span></li><li><a href="Dagger/Dist/index.html"><code>Dagger.Dist</code></a> <span class="synopsis">Distributions</span></li><li><a href="Dagger/Resampling/index.html"><code>Dagger.Resampling</code></a> <span class="synopsis">Resampling functions</span></li></ul></div></body></html>